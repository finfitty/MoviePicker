<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MoviePicker</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes cardShuffle { 0%, 100% { transform: translateX(0); opacity: 1; } 50% { transform: translateX(20px); opacity: 0.7; } }
        .card-shuffle-1 { animation: cardShuffle 1.5s ease-in-out infinite; }
        .card-shuffle-2 { animation: cardShuffle 1.5s ease-in-out infinite; animation-delay: 0.2s; }
        .card-shuffle-3 { animation: cardShuffle 1.5s ease-in-out infinite; animation-delay: 0.4s; }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect } = React;
        const TOKEN = 'eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiI4NDZkYmQ3NzY5MmE3MDY3NGNlMTBhMWM2YjRkNjY2YyIsIm5iZiI6MTc2MzQyMzc5MS4wMDg5OTk4LCJzdWIiOiI2OTFiYjYyZmMzMjkxYzk2ODdjN2QyYTQiLCJzY29wZXMiOlsiYXBpX3JlYWQiXSwidmVyc2lvbiI6MX0.yceVQdz0-IeMdfCDLlmerZZZ9X95mX_5MUEuTHEKnXM';
        
        const Film = ({className}) => <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="2" y="2" width="20" height="20" rx="2"/><line x1="7" y1="2" x2="7" y2="22"/><line x1="17" y1="2" x2="17" y2="22"/><line x1="2" y1="12" x2="22" y2="12"/></svg>;
        const X = ({className}) => <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>;
        const Play = ({className}) => <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="5 3 19 12 5 21 5 3"/></svg>;
        const Star = ({className}) => <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>;
        const Clock = ({className}) => <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>;
        const ChevronLeft = ({className}) => <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="15 18 9 12 15 6"/></svg>;
        const ChevronRight = ({className}) => <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="9 18 15 12 9 6"/></svg>;
        const RefreshCw = ({className}) => <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="23 4 23 10 17 10"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg>;

        function MoviePicker() {
            const [state, setState] = useState({
                suggestions: [], details: {}, loading: true, loadingMsg: 'reading the tea leaves...', 
                trailer: null, watched: [], selected: null, slide: 0, filter: 'all',
                myPicks: ["Scarface","Boogie Nights","Fargo","Raising Arizona","Norma Rae","My Life as a Dog","A River Runs Through It","Erin Brockovich","What's Eating Gilbert Grape","American Graffiti","Chinatown","One Flew Over the Cuckoo's Nest","Taxi Driver","Juno","Chariots of Fire","Psycho","Fried Green Tomatoes","Brokeback Mountain","Walk the Line"]
            });

            // Oscar data - abbreviated for space
            const bestPicture = ["Wings","All Quiet on the Western Front","Grand Hotel","It Happened One Night","Mutiny on the Bounty","Gone with the Wind","Rebecca","Casablanca","The Best Years of Our Lives","All About Eve","From Here to Eternity","On the Waterfront","The Bridge on the River Kwai","Ben-Hur","The Apartment","West Side Story","Lawrence of Arabia","My Fair Lady","The Sound of Music","In the Heat of the Night","Midnight Cowboy","Patton","The French Connection","The Godfather","The Sting","The Godfather Part II","One Flew Over the Cuckoo's Nest","Rocky","Annie Hall","The Deer Hunter","Kramer vs. Kramer","Ordinary People","Chariots of Fire","Gandhi","Terms of Endearment","Amadeus","Out of Africa","Platoon","The Last Emperor","Rain Man","Driving Miss Daisy","Dances with Wolves","The Silence of the Lambs","Unforgiven","Schindler's List","Forrest Gump","Braveheart","The English Patient","Titanic","Shakespeare in Love","American Beauty","Gladiator","A Beautiful Mind","Chicago","The Lord of the Rings: The Return of the King","Million Dollar Baby","Crash","The Departed","No Country for Old Men","Slumdog Millionaire","The Hurt Locker","The King's Speech","The Artist","Argo","12 Years a Slave","Birdman","Spotlight","Moonlight","The Shape of Water","Green Book","Parasite","Nomadland","CODA","Everything Everywhere All at Once","Oppenheimer"];
            const otherWinners = ["Traffic","Training Day","Monster's Ball","The Pianist","Mystic River","The Aviator","Capote","The Queen","There Will Be Blood","Milk","Precious","The Fighter","The Iron Lady","Silver Linings Playbook","Dallas Buyers Club","Whiplash","Still Alice","The Revenant","Manchester by the Sea","Three Billboards Outside Ebbing, Missouri","Bohemian Rhapsody","Judy","Joker","The Father","King Richard","The Whale","TÃ¡r","Poor Things"];
            const foreign = ["Cinema Paradiso","Life Is Beautiful","All About My Mother","Crouching Tiger, Hidden Dragon","Nowhere in Africa","The Barbarian Invasions","The Sea Inside","The Lives of Others","Departures","The Secret in Their Eyes","A Separation","Amour","The Great Beauty","Ida","Son of Saul","The Salesman","A Fantastic Woman","Roma","Parasite","Another Round","Drive My Car","All Quiet on the Western Front","The Zone of Interest"];
            const runnerUps = ["Fargo","L.A. Confidential","Saving Private Ryan","The Sixth Sense","Crouching Tiger, Hidden Dragon","Erin Brockovich","The Lord of the Rings: The Fellowship of the Ring","The Pianist","Brokeback Mountain","Juno","There Will Be Blood","Avatar","Inception","The Social Network","Lincoln","Her","The Grand Budapest Hotel","Mad Max: Fury Road","La La Land","Get Out","Roma","Joker","1917","Dune","The Fabelmans","Barbie","Killers of the Flower Moon","Poor Things"];

            const allMovies = [...new Set([...state.myPicks, ...bestPicture, ...otherWinners, ...foreign, ...runnerUps])];

            const getCats = (m) => {
                const c = [];
                if (state.myPicks.includes(m)) c.push({label:'My Picks',color:'bg-purple-600'});
                if (bestPicture.includes(m) || otherWinners.includes(m) || foreign.includes(m)) c.push({label:'Winner',color:'bg-yellow-600'});
                if (runnerUps.includes(m)) c.push({label:'Runner-up',color:'bg-blue-600'});
                return c;
            };

            const getFiltered = () => {
                if (state.filter === 'all') return allMovies;
                if (state.filter === 'my-picks') return allMovies.filter(m => state.myPicks.includes(m));
                if (state.filter === 'winners') return allMovies.filter(m => bestPicture.includes(m) || otherWinners.includes(m) || foreign.includes(m));
                if (state.filter === 'runner-ups') return allMovies.filter(m => runnerUps.includes(m));
                return allMovies;
            };

            useEffect(() => {
                fetchData();
                const msgs = ['reading the tea leaves...','checking weather...','identifying mood...','finding movies...'];
                let i = 0;
                const int = setInterval(() => {
                    i = (i + 1) % msgs.length;
                    setState(s => ({...s, loadingMsg: msgs[i]}));
                }, 2000);
                return () => clearInterval(int);
            }, []);

            const fetchData = async () => {
                const d = {};
                const opts = {headers: {accept: 'application/json', Authorization: `Bearer ${TOKEN}`}};
                for (let i = 0; i < allMovies.length; i += 5) {
                    await Promise.all(allMovies.slice(i, i+5).map(async (m) => {
                        try {
                            const sr = await fetch(`https://api.themoviedb.org/3/search/movie?query=${encodeURIComponent(m)}&include_adult=false`, opts);
                            const sd = await sr.json();
                            if (sd.results?.length > 0) {
                                const id = sd.results[0].id;
                                const [dr, cr, vr, wr] = await Promise.all([
                                    fetch(`https://api.themoviedb.org/3/movie/${id}`, opts),
                                    fetch(`https://api.themoviedb.org/3/movie/${id}/credits`, opts),
                                    fetch(`https://api.themoviedb.org/3/movie/${id}/videos`, opts),
                                    fetch(`https://api.themoviedb.org/3/movie/${id}/watch/providers`, opts)
                                ]);
                                const md = await dr.json();
                                const cd = await cr.json();
                                const vd = await vr.json();
                                const wd = await wr.json();
                                d[m] = {...md, actors: cd.cast?.slice(0,5).map(a=>a.name)||[], trailer: vd.results?.find(v=>v.type==='Trailer'&&v.site==='YouTube')?.key, director: cd.crew?.find(p=>p.job==='Director')?.name, providers: wd.results?.US};
                            }
                        } catch(e) {}
                    }));
                }
                setState(s => ({...s, details: d, loading: false}));
                newSuggestions();
            };

            const newSuggestions = () => {
                const f = getFiltered().filter(m => !state.watched.includes(m));
                if (f.length === 0) { setState(s => ({...s, suggestions: []})); return; }
                const sh = [...f].sort(() => Math.random() - 0.5);
                setState(s => ({...s, suggestions: sh.slice(0,3), slide: 0}));
            };

            const Card = ({m, compact}) => {
                const d = state.details[m];
                const cats = getCats(m);
                if (!d) return <div className="bg-gray-800 rounded-lg p-6"><p className="text-gray-300">Loading...</p></div>;
                
                if (!compact) {
                    return (
                        <div className="bg-gray-800 rounded-lg overflow-hidden shadow-xl">
                            <div className="flex flex-col md:flex-row max-h-[80vh]">
                                <div className="md:w-1/3 flex-shrink-0">
                                    {d.poster_path ? <img src={`https://image.tmdb.org/t/p/w500${d.poster_path}`} alt={m} className="w-full h-full object-cover"/> : <div className="w-full h-64 md:h-full bg-gray-700 flex items-center justify-center"><Film className="w-16 h-16 text-gray-500"/></div>}
                                </div>
                                <div className="p-6 flex-1 overflow-y-auto">
                                    <h3 className="text-2xl font-bold mb-3">{d.title}</h3>
                                    {cats.length > 0 && <div className="flex flex-wrap gap-2 mb-3">{cats.map((c,i) => <span key={i} className={`${c.color} text-white px-3 py-1 rounded-full text-xs font-semibold`}>{c.label}</span>)}</div>}
                                    <div className="flex flex-wrap gap-4 mb-4 text-sm">
                                        {d.vote_average > 0 && <div className="flex items-center gap-1"><Star className="w-4 h-4 text-yellow-400 fill-yellow-400"/><span className="font-semibold">{d.vote_average.toFixed(1)}</span><span className="text-gray-400">/10</span></div>}
                                        {d.runtime && <div className="flex items-center gap-1"><Clock className="w-4 h-4 text-blue-400"/><span>{d.runtime} min</span></div>}
                                    </div>
                                    {d.overview && <p className="text-gray-300 mb-4">{d.overview}</p>}
                                    {d.actors?.length > 0 && <div className="mb-3"><p className="text-sm"><span className="text-gray-400">Starring:</span> {d.actors.join(', ')}</p></div>}
                                    {d.director && <div className="mb-4"><p className="text-sm"><span className="text-gray-400">Director:</span> {d.director}</p></div>}
                                    {d.providers && <div className="mb-4"><p className="text-sm text-gray-400 mb-2">Where to watch:</p><div className="flex flex-wrap gap-2">{d.providers.flatrate?.map((p,i) => <span key={i} className="text-xs bg-gray-700 px-2 py-1 rounded">{p.provider_name}</span>)}{!d.providers.flatrate?.length && d.providers.rent?.slice(0,3).map((p,i) => <span key={i} className="text-xs bg-gray-700 px-2 py-1 rounded">Rent: {p.provider_name}</span>)}{!d.providers.flatrate?.length && !d.providers.rent?.length && <span className="text-xs text-gray-500">Not available</span>}</div></div>}
                                    <div className="flex flex-wrap gap-3">
                                        {d.trailer && <button onClick={() => setState(s=>({...s,trailer:d.trailer}))} className="flex items-center gap-2 bg-gradient-to-r from-pink-500 to-rose-500 hover:from-pink-600 hover:to-rose-600 text-white px-4 py-2.5 rounded-full transition shadow-lg font-medium text-sm"><Play className="w-4 h-4"/>Watch trailer</button>}
                                        {!state.watched.includes(m) ? <button onClick={() => setState(s=>({...s,watched:[...s.watched,m]}))} className="flex items-center gap-2 border-2 border-gray-600 text-gray-300 hover:border-gray-500 hover:text-white px-4 py-2 rounded-full transition font-medium text-sm">Mark as watched</button> : <button onClick={() => setState(s=>({...s,watched:s.watched.filter(w=>w!==m)}))} className="flex items-center gap-2 border-2 border-gray-600 text-gray-300 hover:border-gray-500 hover:text-white px-4 py-2 rounded-full transition font-medium text-sm">Mark as unwatched</button>}
                                        {!state.myPicks.includes(m) && <button onClick={() => setState(s=>({...s,myPicks:[...s.myPicks,m]}))} className="flex items-center gap-2 border-2 border-purple-600 text-purple-400 hover:bg-purple-600 hover:text-white px-4 py-2 rounded-full transition font-medium text-sm">Add to my picks</button>}
                                    </div>
                                </div>
                            </div>
                        </div>
                    );
                }
                
                return (
                    <div onClick={() => setState(s=>({...s,selected:m}))} className="bg-gray-800 rounded-lg overflow-hidden shadow-xl hover:shadow-2xl transition hover:scale-105 cursor-pointer" style={{height:'420px'}}>
                        <div className="relative">
                            {d.poster_path ? <img src={`https://image.tmdb.org/t/p/w300${d.poster_path}`} alt={m} className="w-full aspect-[2/3] object-cover"/> : <div className="w-full aspect-[2/3] bg-gray-700 flex items-center justify-center"><Film className="w-8 h-8 text-gray-500"/></div>}
                            <div className="absolute top-2 left-2 flex flex-wrap gap-1">{cats.map((c,i) => <span key={i} className={`${c.color} text-white px-2 py-0.5 rounded-full text-xs font-semibold`}>{c.label}</span>)}</div>
                        </div>
                        <div className="p-3">
                            <h3 className="font-bold text-sm leading-tight mb-1 line-clamp-2">{d.title}</h3>
                            <div className="flex items-center gap-2 text-xs text-gray-400 mb-1">
                                {d.vote_average > 0 && <div className="flex items-center gap-1"><Star className="w-3 h-3 text-yellow-400 fill-yellow-400"/><span>{d.vote_average.toFixed(1)}</span></div>}
                                {d.runtime && <span>{d.runtime} min</span>}
                            </div>
                            {d.overview && <p className="text-xs text-gray-300 line-clamp-2 mb-1">{d.overview}</p>}
                            {d.director && <p className="text-xs text-gray-400 truncate">Dir: {d.director}</p>}
                        </div>
                    </div>
                );
            };

            if (state.loading) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-gray-900 via-blue-900 to-gray-900 text-white flex items-center justify-center">
                        <div className="text-center">
                            <div className="flex gap-4 mb-8 justify-center">
                                <div className="w-32 h-48 bg-gray-800 rounded-lg card-shuffle-1"></div>
                                <div className="w-32 h-48 bg-gray-800 rounded-lg card-shuffle-2"></div>
                                <div className="w-32 h-48 bg-gray-800 rounded-lg card-shuffle-3"></div>
                            </div>
                            <Film className="w-16 h-16 text-blue-400 animate-pulse mx-auto mb-4"/>
                            <p className="text-xl">{state.loadingMsg}</p>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gradient-to-br from-gray-900 via-blue-900 to-gray-900 text-white">
                    <div className="bg-black bg-opacity-50 shadow-lg backdrop-blur sticky top-0 z-10">
                        <div className="max-w-6xl mx-auto px-3 lg:px-4 py-3 lg:py-4">
                            <div className="flex items-center justify-between flex-wrap gap-2">
                                <div className="flex flex-col gap-0 cursor-pointer hover:opacity-80 transition" onClick={() => {setState(s=>({...s,filter:'all',selected:null})); newSuggestions();}}>
                                    <div className="flex items-center gap-2"><Film className="w-5 h-5 lg:w-7 lg:h-7 text-blue-400"/><h1 className="text-lg lg:text-2xl font-bold">MoviePicker</h1></div>
                                    <p className="text-xs lg:text-sm text-gray-400 ml-7 lg:ml-9">{state.filter==='all'?'All movies':state.filter==='my-picks'?'My picks':state.filter==='winners'?'Academy Award winners':'Best Picture runner-up'}</p>
                                </div>
                                <div className="flex gap-2 items-center">
                                    <button onClick={() => {setState(s=>({...s,filter:'my-picks'})); newSuggestions();}} className={`px-3 py-2 rounded-lg transition text-xs font-medium ${state.filter==='my-picks'?'bg-purple-600':'bg-gray-800 hover:bg-gray-700'}`}>My picks</button>
                                    <button onClick={() => {setState(s=>({...s,filter:'winners'})); newSuggestions();}} className={`px-3 py-2 rounded-lg transition text-xs font-medium ${state.filter==='winners'?'bg-yellow-600':'bg-gray-800 hover:bg-gray-700'}`}>Winners</button>
                                    <button onClick={() => {setState(s=>({...s,filter:'runner-ups'})); newSuggestions();}} className={`px-3 py-2 rounded-lg transition text-xs font-medium ${state.filter==='runner-ups'?'bg-blue-600':'bg-gray-800 hover:bg-gray-700'}`}>Runner-up</button>
                                    <button onClick={newSuggestions} className="p-2 bg-gray-800 hover:bg-gray-700 rounded-lg transition"><RefreshCw className="w-4 h-4"/></button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div className="max-w-6xl mx-auto px-4 py-8">
                        {getFiltered().filter(m=>!state.watched.includes(m)).length===0 ? (
                            <div className="text-center py-12"><h2 className="text-2xl font-semibold mb-4">ðŸŽ‰ You've watched everything in this category!</h2></div>
                        ) : (
                            <>
                                <div className="relative">
                                    {state.slide > 0 && <button onClick={() => setState(s=>({...s,slide:s.slide-1}))} className="hidden lg:block absolute left-0 top-1/2 -translate-y-1/2 -translate-x-12 z-10 bg-blue-600 hover:bg-blue-700 text-white p-3 rounded-full shadow-lg transition"><ChevronLeft className="w-6 h-6"/></button>}
                                    {state.slide < state.suggestions.length-1 && <button onClick={() => setState(s=>({...s,slide:s.slide+1}))} className="hidden lg:block absolute right-0 top-1/2 -translate-y-1/2 translate-x-12 z-10 bg-blue-600 hover:bg-blue-700 text-white p-3 rounded-full shadow-lg transition"><ChevronRight className="w-6 h-6"/></button>}
                                    <div className="overflow-hidden">
                                        <div className="flex gap-4 transition-transform duration-500 ease-out" style={{transform:`translateX(calc(-${state.slide*100}% - ${state.slide*16}px))`}} onTouchStart={e => e.currentTarget.dataset.startX=e.touches[0].clientX} onTouchEnd={e => {const d=parseFloat(e.currentTarget.dataset.startX)-e.changedTouches[0].clientX; if(Math.abs(d)>50){if(d>0 && state.slide<state.suggestions.length-1) setState(s=>({...s,slide:s.slide+1})); else if(d<0 && state.slide>0) setState(s=>({...s,slide:s.slide-1}));}}}>
                                            {state.suggestions.map((m,i) => <div key={i} className="flex-shrink-0" style={{width:'calc(100% - 80px)'}}><Card m={m} compact={true}/></div>)}
                                        </div>
                                    </div>
                                    <div className="flex justify-center gap-2 mt-6">{state.suggestions.map((_,i) => <button key={i} onClick={() => setState(s=>({...s,slide:i}))} className={`h-2 rounded-full transition-all ${state.slide===i?'bg-pink-500 w-8':'bg-gray-600 w-2'}`}/>)}</div>
                                </div>
                            </>
                        )}
                    </div>

                    {state.trailer && (
                        <div className="fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50 p-4">
                            <div className="relative w-full max-w-4xl">
                                <button onClick={() => setState(s=>({...s,trailer:null}))} className="absolute -top-12 right-0 text-white hover:text-gray-300 transition"><X className="w-8 h-8"/></button>
                                <div className="relative pt-[56.25%]"><iframe className="absolute inset-0 w-full h-full" src={`https://www.youtube.com/embed/${state.trailer}`} title="Trailer" frameBorder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowFullScreen></iframe></div>
                            </div>
                        </div>
                    )}

                    {state.selected && (
                        <div className="fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50 p-4 overflow-y-auto">
                            <div className="relative w-full max-w-5xl my-8">
                                <button onClick={() => setState(s=>({...s,selected:null}))} className="absolute -top-12 right-0 text-white hover:text-gray-300 transition z-10"><X className="w-8 h-8"/></button>
                                <div className="bg-gray-800 rounded-lg overflow-hidden shadow-2xl"><Card m={state.selected} compact={false}/></div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        ReactDOM.render(<MoviePicker />, document.getElementById('root'));
    </script>
</body>
</html>
